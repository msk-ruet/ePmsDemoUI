<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Goal Management Dashboard - Staff Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#1e40af',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar {
            background-color: #034ea2;
            color: white;
        }
        .sidebar a:not(.active-nav-item):hover {
            background-color: #1e40af;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="sidebar w-64 flex flex-col">
            <div class="p-4 flex items-center justify-center border-b border-blue-700">
                <h1 class="text-xl font-bold">Logo</h1>
            </div>
            <nav class="flex-1 p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" class="flex items-center p-3 rounded-lg">
                            <i class="fas fa-tachometer-alt mr-3"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center p-3 rounded-lg" id="kraNavBtn">
                            <i class="fas fa-user-clock mr-3"></i>
                            <span>Attendance</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center p-3 rounded-lg">
                            <i class="fas fa-calendar-alt mr-3"></i>
                            <span>Leave</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center p-3 rounded-lg">
                            <i class="fas fa-user-check mr-3"></i>
                            <span>Employee Visit</span>
                        </a>
                    </li>
                    <li>
                        <a href="index.html" class="flex items-center p-3 rounded-lg">
                            <i class="fas fa-chart-line mr-3"></i>
                            <span>ePMS</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center p-3 rounded-lg">
                            <i class="fas fa-address-book mr-3"></i>
                            <span>Employee Contact</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="p-4 border-t border-blue-700">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center">
                        <span class="font-bold">AD</span>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium">Admin User</p>
                        <p class="text-xs text-blue-200">admin@company.com</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between px-4 lg:px-6 py-4">
                    <div class="flex items-center">
                        <h2 class="text-lg lg:text-xl font-semibold text-gray-800">Welcome to ESS</h2>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button class="p-2 text-gray-500 hover:text-gray-700">
                                <i class="fas fa-bell text-xl"></i>
                                <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">5</span>
                            </button>
                        </div>
                        <div class="flex items-center">
                            <img class="h-8 w-8 rounded-full object-cover" src="https://ui-avatars.com/api/?name=Supervisor+User&background=0D8ABC&color=fff" alt="Supervisor User">
                            <span class="ml-2 text-sm font-medium text-gray-700 hidden md:block">Admin User</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div class="flex-1 overflow-y-auto p-4 lg:p-8">
                <div class="container mx-auto">
                    <header class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-800">Organizational Goals</h1>
                        <p class="text-gray-600 mt-2">Staff Dashboard - You can add subtasks to existing tasks</p>
                    </header>

                    <div class="flex flex-col lg:flex-row gap-8">
                        <!-- Left Panel - Goals List -->
                        <div class="w-full lg:w-1/3 bg-white rounded-lg shadow-md p-6">
                            <div class="mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-xl font-semibold text-gray-700">All Goals (3)</h2>
                                </div>
                                
                                <!-- Status Tabs -->
                                <div class="flex border-b border-gray-200 mb-4">
                                    <button class="status-tab active px-4 py-2 font-medium text-primary border-b-2 border-primary">All</button>
                                    <button class="status-tab px-4 py-2 font-medium text-gray-500 hover:text-gray-700">In Progress</button>
                                    <button class="status-tab px-4 py-2 font-medium text-gray-500 hover:text-gray-700">Completed</button>
                                </div>
                            </div>

                            <!-- Goals List -->
                            <div id="goals-list" class="space-y-4">
                                <!-- Goal cards will be dynamically inserted here -->
                            </div>
                        </div>

                        <!-- Right Panel - Goal Details -->
                        <div class="w-full lg:w-2/3 bg-white rounded-lg shadow-md p-6">
                            <div id="goal-details" class="h-full">
                                <div class="flex flex-col items-center justify-center h-full text-center text-gray-500">
                                    <i class="fas fa-bullseye text-5xl mb-4"></i>
                                    <h3 class="text-xl font-medium mb-2">Select a Goal</h3>
                                    <p>Click on a goal from the list to view its details</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Subtask Modal -->
    <div id="add-subtask-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Add Subtask</h3>
                <form id="add-subtask-form">
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="subtask-name">Subtask Name</label>
                        <input type="text" id="subtask-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-add-subtask" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const goals = [
            {
                id: 1,
                name: "Launch New Platform Q3 2024",
                description: "Target: Successfully launch the new customer platform by end of Q3.",
                departments: ["Engineering", "Marketing"],
                startDate: "2024-07-01",
                endDate: "2024-09-30",
                progress: 66,
                status: "in-progress",
                subgoals: [
                    { 
                        id: 1, 
                        name: "Develop Core Features", 
                        owner: "Charlie Brown", 
                        expanded: false,
                        tasks: [
                            { 
                                id: 1, 
                                name: "Scope feature requirements", 
                                completed: true, 
                                assignee: "Charlie Brown",
                                subtasks: [
                                    { id: 1, name: "Gather user stories", completed: true },
                                    { id: 2, name: "Document requirements", completed: true }
                                ]
                            },
                            { 
                                id: 2, 
                                name: "Develop authentication module", 
                                completed: true, 
                                assignee: "Charlie Brown",
                                subtasks: [
                                    { id: 1, name: "Design database schema", completed: true },
                                    { id: 2, name: "Implement login API", completed: true }
                                ]
                            },
                            { 
                                id: 3, 
                                name: "Build dashboard UI", 
                                completed: true, 
                                assignee: "Charlie Brown",
                                subtasks: [
                                    { id: 1, name: "Create wireframes", completed: true },
                                    { id: 2, name: "Implement responsive layout", completed: false }
                                ]
                            }
                        ]
                    },
                    { 
                        id: 2, 
                        name: "Marketing & Go-to-Market Strategy", 
                        owner: "Diana Prince", 
                        expanded: false,
                        tasks: [
                            { 
                                id: 1, 
                                name: "Define target audience", 
                                completed: true, 
                                assignee: "Diana Prince",
                                subtasks: [
                                    { id: 1, name: "Conduct market research", completed: true },
                                    { id: 2, name: "Create buyer personas", completed: true }
                                ]
                            },
                            { 
                                id: 2, 
                                name: "Create launch campaign assets", 
                                completed: true, 
                                assignee: "Diana Prince",
                                subtasks: [
                                    { id: 1, name: "Design promotional materials", completed: true },
                                    { id: 2, name: "Write press release", completed: false }
                                ]
                            },
                            { 
                                id: 3, 
                                name: "Plan social media push", 
                                completed: false, 
                                assignee: "Diana Prince",
                                subtasks: [
                                    { id: 1, name: "Schedule posts", completed: false }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 2,
                name: "Improve Customer Satisfaction",
                description: "Increase customer satisfaction scores by 15% through improved support and product enhancements.",
                departments: ["Marketing", "HR"],
                startDate: "2024-06-01",
                endDate: "2024-12-31",
                progress: 25,
                status: "in-progress",
                subgoals: []
            },
            {
                id: 3,
                name: "Engineering HR Progress",
                description: "Improve HR processes within the engineering department.",
                departments: ["Engineering", "HR"],
                startDate: "2024-05-15",
                endDate: "2024-08-15",
                progress: 0,
                status: "all",
                subgoals: []
            }
        ];

        // DOM Elements
        const goalsList = document.getElementById('goals-list');
        const goalDetails = document.getElementById('goal-details');
        const addSubtaskModal = document.getElementById('add-subtask-modal');
        const cancelAddSubtaskBtn = document.getElementById('cancel-add-subtask');
        const addSubtaskForm = document.getElementById('add-subtask-form');
        const statusTabs = document.querySelectorAll('.status-tab');

        // Current selected goal, subgoal, and task
        let selectedGoalId = null;
        let selectedSubgoalId = null;
        let selectedTaskId = null;

        // Initialize the dashboard
        function initDashboard() {
            renderGoalsList();
            setupEventListeners();
        }

        // Render goals list based on selected status and department
        function renderGoalsList(status = 'all', department = 'all') {
            goalsList.innerHTML = '';
            
            const filteredGoals = goals.filter(goal => {
                const statusMatch = status === 'all' || goal.status === status;
                const departmentMatch = department === 'all' || goal.departments.includes(department);
                return statusMatch && departmentMatch;
            });
            
            if (filteredGoals.length === 0) {
                goalsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>No goals found</p>
                    </div>
                `;
                return;
            }
            
            filteredGoals.forEach(goal => {
                const goalCard = document.createElement('div');
                goalCard.className = 'goal-card bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow cursor-pointer';
                goalCard.dataset.id = goal.id;
                
                const departments = goal.departments.join(', ');
                
                goalCard.innerHTML = `
                    <div class="mb-2">
                        <h3 class="font-semibold text-gray-800">${goal.name}</h3>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">${goal.description}</p>
                    <div class="flex items-center">
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mr-2">
                            <div class="bg-primary h-2.5 rounded-full" style="width: ${goal.progress}%"></div>
                        </div>
                        <span class="text-xs font-medium text-gray-700">${goal.progress}%</span>
                    </div>
                    <div class="flex justify-between mt-2 text-xs text-gray-500">
                        <span>Start: ${new Date(goal.startDate).toLocaleDateString()}</span>
                        <span>End: ${new Date(goal.endDate).toLocaleDateString()}</span>
                    </div>
                `;
                
                goalsList.appendChild(goalCard);
            });
            
            // Add event listeners to goal cards
            document.querySelectorAll('.goal-card').forEach(card => {
                card.addEventListener('click', () => {
                    const goalId = parseInt(card.dataset.id);
                    selectGoal(goalId);
                });
            });
        }

        // Render goal details
        function renderGoalDetails(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const departments = goal.departments.join(', ');
            const startDate = new Date(goal.startDate).toLocaleDateString();
            const endDate = new Date(goal.endDate).toLocaleDateString();
            
            goalDetails.innerHTML = `
                <div class="mb-6">
                    <div class="mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">${goal.name}</h2>
                    </div>
                    <p class="text-gray-600 mb-4">${goal.description}</p>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <span class="text-sm font-medium text-gray-700">Start Date:</span>
                            <span class="text-sm text-gray-600 ml-2">${startDate}</span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-700">End Date:</span>
                            <span class="text-sm text-gray-600 ml-2">${endDate}</span>
                        </div>
                    </div>
                    <div class="mb-6">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-gray-700">Overall Progress</span>
                            <span class="text-sm font-medium text-gray-700">${goal.progress}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-primary h-2.5 rounded-full" style="width: ${goal.progress}%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">Sub-Goals</h3>
                    </div>
                    
                    <div id="subgoals-list" class="space-y-4">
                        ${goal.subgoals.length > 0 ? 
                            goal.subgoals.map(subgoal => {
                                const completedTasks = subgoal.tasks.filter(task => task.completed).length;
                                const totalTasks = subgoal.tasks.length;
                                const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                                
                                return `
                                    <div class="border border-gray-200 rounded-lg">
                                        <div class="subgoal-header p-4 cursor-pointer flex justify-between items-center" data-subgoal-id="${subgoal.id}">
                                            <div class="flex items-center">
                                                <i class="fas fa-chevron-${subgoal.expanded ? 'down' : 'right'} mr-2 text-gray-500"></i>
                                                <h4 class="font-medium text-gray-800">${subgoal.name}</h4>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-sm text-gray-600 mr-3">Owner: ${subgoal.owner}</span>
                                                <span class="text-xs font-medium px-2 py-1 rounded-full ${progress === 100 ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                                    ${progress}%
                                                </span>
                                            </div>
                                        </div>
                                        <div class="subgoal-content ${subgoal.expanded ? '' : 'hidden'} p-4 border-t border-gray-200">
                                            <div class="mb-3">
                                                <div class="flex justify-between mb-1">
                                                    <span class="text-xs text-gray-600">Progress</span>
                                                    <span class="text-xs font-medium text-gray-700">${progress}%</span>
                                                </div>
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div class="bg-success h-2 rounded-full" style="width: ${progress}%"></div>
                                                </div>
                                            </div>
                                            <div class="mb-4">
                                                <h5 class="text-sm font-medium text-gray-700 mb-2">Tasks</h5>
                                                <div class="space-y-3">
                                                    ${subgoal.tasks.map(task => {
                                                        const completedSubtasks = task.subtasks.filter(subtask => subtask.completed).length;
                                                        const totalSubtasks = task.subtasks.length;
                                                        const taskProgress = totalSubtasks > 0 ? Math.round((completedSubtasks / totalSubtasks) * 100) : 0;
                                                        
                                                        return `
                                                            <div class="border border-gray-200 rounded-md p-3">
                                                                <div class="flex items-center justify-between mb-2">
                                                                    <div class="flex items-center">
                                                                        <input type="checkbox" ${task.completed ? 'checked' : ''} class="mr-2 task-checkbox" data-goal-id="${goal.id}" data-subgoal-id="${subgoal.id}" data-task-id="${task.id}">
                                                                        <span class="text-sm font-medium ${task.completed ? 'text-gray-500 line-through' : 'text-gray-700'}">${task.name}</span>
                                                                    </div>
                                                                    <span class="text-xs text-gray-500">${task.assignee}</span>
                                                                </div>
                                                                <div class="mb-2">
                                                                    <div class="flex justify-between mb-1">
                                                                        <span class="text-xs text-gray-600">Task Progress</span>
                                                                        <span class="text-xs font-medium text-gray-700">${taskProgress}%</span>
                                                                    </div>
                                                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                                        <div class="bg-warning h-1.5 rounded-full" style="width: ${taskProgress}%"></div>
                                                                    </div>
                                                                </div>
                                                                <div class="flex justify-between items-center mb-2">
                                                                    <h6 class="text-xs font-medium text-gray-700">Subtasks</h6>
                                                                    <button class="add-subtask-btn text-xs bg-primary hover:bg-secondary text-white px-2 py-1 rounded flex items-center" data-goal-id="${goal.id}" data-subgoal-id="${subgoal.id}" data-task-id="${task.id}">
                                                                        <i class="fas fa-plus mr-1"></i> Add Subtask
                                                                    </button>
                                                                </div>
                                                                <div class="space-y-1">
                                                                    ${task.subtasks.map(subtask => `
                                                                        <div class="flex items-center justify-between">
                                                                            <div class="flex items-center">
                                                                                <input type="checkbox" ${subtask.completed ? 'checked' : ''} class="mr-2 subtask-checkbox" data-goal-id="${goal.id}" data-subgoal-id="${subgoal.id}" data-task-id="${task.id}" data-subtask-id="${subtask.id}">
                                                                                <span class="text-xs ${subtask.completed ? 'text-gray-500 line-through' : 'text-gray-700'}">${subtask.name}</span>
                                                                            </div>
                                                                        </div>
                                                                    `).join('')}
                                                                </div>
                                                            </div>
                                                        `;
                                                    }).join('')}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('') : 
                            '<p class="text-gray-500 text-center py-4">No sub-goals added yet</p>'
                        }
                    </div>
                </div>
            `;
            
            // Add event listeners to subgoal headers for expand/collapse
            document.querySelectorAll('.subgoal-header').forEach(header => {
                header.addEventListener('click', () => {
                    const subgoalId = parseInt(header.dataset.subgoalId);
                    toggleSubgoal(goalId, subgoalId);
                });
            });
            
            // Add event listeners to task checkboxes
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const goalId = parseInt(checkbox.dataset.goalId);
                    const subgoalId = parseInt(checkbox.dataset.subgoalId);
                    const taskId = parseInt(checkbox.dataset.taskId);
                    toggleTaskCompletion(goalId, subgoalId, taskId, e.target.checked);
                });
            });
            
            // Add event listeners to subtask checkboxes
            document.querySelectorAll('.subtask-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const goalId = parseInt(checkbox.dataset.goalId);
                    const subgoalId = parseInt(checkbox.dataset.subgoalId);
                    const taskId = parseInt(checkbox.dataset.taskId);
                    const subtaskId = parseInt(checkbox.dataset.subtaskId);
                    toggleSubtaskCompletion(goalId, subgoalId, taskId, subtaskId, e.target.checked);
                });
            });
            
            // Add event listeners to add subtask buttons
            document.querySelectorAll('.add-subtask-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const goalId = parseInt(btn.dataset.goalId);
                    const subgoalId = parseInt(btn.dataset.subgoalId);
                    const taskId = parseInt(btn.dataset.taskId);
                    openAddSubtaskModal(goalId, subgoalId, taskId);
                });
            });
        }

        // Toggle subgoal expand/collapse
        function toggleSubgoal(goalId, subgoalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const subgoal = goal.subgoals.find(sg => sg.id === subgoalId);
            if (!subgoal) return;
            
            subgoal.expanded = !subgoal.expanded;
            renderGoalDetails(goalId);
        }

        // Toggle task completion
        function toggleTaskCompletion(goalId, subgoalId, taskId, completed) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const subgoal = goal.subgoals.find(sg => sg.id === subgoalId);
            if (!subgoal) return;
            
            const task = subgoal.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            task.completed = completed;
            
            // Update goal progress
            updateGoalProgress(goalId);
            
            // Re-render the goal details to show updated progress
            renderGoalDetails(goalId);
        }

        // Toggle subtask completion
        function toggleSubtaskCompletion(goalId, subgoalId, taskId, subtaskId, completed) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const subgoal = goal.subgoals.find(sg => sg.id === subgoalId);
            if (!subgoal) return;
            
            const task = subgoal.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const subtask = task.subtasks.find(st => st.id === subtaskId);
            if (!subtask) return;
            
            subtask.completed = completed;
            
            // Update task completion if all subtasks are completed
            const allSubtasksCompleted = task.subtasks.every(st => st.completed);
            if (allSubtasksCompleted && !task.completed) {
                task.completed = true;
            } else if (!allSubtasksCompleted && task.completed) {
                task.completed = false;
            }
            
            // Update goal progress
            updateGoalProgress(goalId);
            
            // Re-render the goal details to show updated progress
            renderGoalDetails(goalId);
        }

        // Update goal progress based on subgoal completion
        function updateGoalProgress(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal || goal.subgoals.length === 0) return;
            
            let totalProgress = 0;
            goal.subgoals.forEach(subgoal => {
                const completedTasks = subgoal.tasks.filter(task => task.completed).length;
                const totalTasks = subgoal.tasks.length;
                const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                totalProgress += progress;
            });
            
            goal.progress = Math.round(totalProgress / goal.subgoals.length);
        }

        // Select a goal to view details
        function selectGoal(goalId) {
            selectedGoalId = goalId;
            document.querySelectorAll('.goal-card').forEach(card => {
                card.classList.remove('border-primary', 'bg-blue-50');
                if (parseInt(card.dataset.id) === goalId) {
                    card.classList.add('border-primary', 'bg-blue-50');
                }
            });
            renderGoalDetails(goalId);
        }

        // Open add subtask modal
        function openAddSubtaskModal(goalId, subgoalId, taskId) {
            selectedGoalId = goalId;
            selectedSubgoalId = subgoalId;
            selectedTaskId = taskId;
            addSubtaskModal.classList.remove('hidden');
        }

        // Close add subtask modal
        function closeAddSubtaskModal() {
            addSubtaskModal.classList.add('hidden');
            addSubtaskForm.reset();
        }

        // Add a subtask
        function addSubtask(event) {
            event.preventDefault();
            
            const name = document.getElementById('subtask-name').value;
            
            if (name && selectedGoalId && selectedSubgoalId && selectedTaskId) {
                const goal = goals.find(g => g.id === selectedGoalId);
                if (goal) {
                    const subgoal = goal.subgoals.find(sg => sg.id === selectedSubgoalId);
                    if (subgoal) {
                        const task = subgoal.tasks.find(t => t.id === selectedTaskId);
                        if (task) {
                            const newSubtask = {
                                id: task.subtasks.length > 0 ? Math.max(...task.subtasks.map(st => st.id)) + 1 : 1,
                                name,
                                completed: false
                            };
                            
                            task.subtasks.push(newSubtask);
                            updateGoalProgress(selectedGoalId);
                            renderGoalDetails(selectedGoalId);
                            closeAddSubtaskModal();
                            
                            // Show success message
                            alert('Subtask added successfully!');
                        }
                    }
                }
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Add subtask modal
            cancelAddSubtaskBtn.addEventListener('click', closeAddSubtaskModal);
            addSubtaskForm.addEventListener('submit', addSubtask);
            
            // Status tabs
            statusTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    statusTabs.forEach(t => t.classList.remove('active', 'text-primary', 'border-primary'));
                    statusTabs.forEach(t => t.classList.add('text-gray-500'));
                    
                    tab.classList.add('active', 'text-primary', 'border-primary');
                    tab.classList.remove('text-gray-500');
                    
                    const status = tab.textContent.toLowerCase().replace(' ', '-');
                    renderGoalsList(status);
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === addSubtaskModal) {
                    closeAddSubtaskModal();
                }
            });
        }

        // Initialize the dashboard when the page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>